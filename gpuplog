#!/usr/bin/env sh

main() {
    base="$HOME/data/instagram"

    num=$(( "$( find "$base/.." -mindepth 1 -maxdepth 1 -type d -name "log*" -printf "%f\n" | sort | tail -n 1 | sed 's/log//' )" + 1 ))

    mkdir "$base/../log$num" || return
    cp "$base/log.log" "$base"/usr_*.log "$base/../log$num" || return

    grep -E ':\sOK' "$base"/usr_*.log | awk '{print $2}' | sed -e 's/\:$//' -e 's/.*\///' >> "$base/log.log"
    cat "$base/log.log" > "$base/logtemp.log"
    cat "$base/logtemp.log" | sort > "$base/log.log"
    rm "$base/logtemp.log" "$base"/usr_*.log
}

main
